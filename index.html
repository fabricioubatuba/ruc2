<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking Ubatuba de Ciclismo - R.U.C.</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #333;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
            margin-top: 0;
        }
        
        .race-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .race-title {
            color: #2c3e50;
            margin-top: 0;
        }
        
        .race-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .race-date, .race-price {
            font-weight: bold;
        }
        
        .race-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .status-open {
            background-color: #4CAF50;
            color: white;
        }
        
        .status-closed {
            background-color: #F44336;
            color: white;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background-color: #2196F3;
        }
        
        .btn-success {
            background-color: #4CAF50;
        }
        
        .btn-danger {
            background-color: #F44336;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            max-width: 600px;
            border-radius: 5px;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .admin-panel {
            margin-top: 30px;
            padding: 20px;
            background-color: #e9e9e9;
            border-radius: 5px;
            display: none;
        }
        
        .login-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .login-btn {
            background-color: #4CAF50;
        }
        
        .logout-btn {
            background-color: #F44336;
        }
        
        .loading-spinner {
            display: none;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        .start-list {
            margin-top: 30px;
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .start-list h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .start-list table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .start-list th, .start-list td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .start-list th {
            background-color: #f2f2f2;
        }
        
        .action-btn {
            padding: 5px 10px;
            margin: 0 2px;
            border: none;
            border-radius: 3px;
            color: white;
            cursor: pointer;
        }
        
        .edit-btn {
            background-color: #2196F3;
        }
        
        .delete-btn {
            background-color: #F44336;
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            color: white;
        }
        
        .status-pending {
            background-color: #FF9800;
        }
        
        .status-waiting {
            background-color: #2196F3;
        }
        
        .status-completed {
            background-color: #4CAF50;
        }
        
        .status-filter {
            margin-bottom: 15px;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #ddd;
            background-color: white;
        }
        
        .race-image {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .image-upload {
            margin-bottom: 15px;
        }
        
        .options-container {
            margin-bottom: 15px;
        }
        
        .options-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .options-checkbox {
            margin-right: 10px;
        }
        
        .options-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 5px;
        }
        
        .option-item {
            display: flex;
            align-items: center;
            background-color: #f0f0f0;
            padding: 5px 10px;
            border-radius: 4px;
        }
        
        .regulation-btn {
            margin-top: 10px;
            display: inline-block;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .race-info {
                flex-direction: column;
            }
            
            .race-date, .race-price {
                margin-bottom: 10px;
            }
            
            .start-list table {
                display: block;
                overflow-x: auto;
            }
            
            .options-list {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Ranking Ubatuba de Ciclismo - R.U.C.</h1>
        <p class="subtitle">Inscreva-se nas próximas provas e desafie seus limites!</p>
    </header>
    
    <div id="races-container">
        <div class="loading-spinner" id="races-spinner"></div>
    </div>
    
    <div class="login-container" id="login-section">
        <button id="login-btn" class="btn login-btn">Login Admin</button>
    </div>
    
    <div class="admin-panel" id="admin-panel">
        <h2>Painel Administrativo</h2>
        <p>Você está logado como administrador.</p>
        <button id="add-race-btn" class="btn btn-primary">Adicionar Nova Prova</button>
        <button id="logout-btn" class="btn logout-btn">Logout</button>
    </div>
    
    <!-- Modal de inscrição -->
    <div id="register-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Inscrição na Prova</h2>
            <p id="race-selected-name" style="font-weight: bold; margin-bottom: 20px;"></p>
            
            <div class="form-group">
                <label for="full-name">Nome Completo:</label>
                <input type="text" id="full-name" required>
            </div>
            
            <div class="form-group">
                <label for="birth-date">Data de Nascimento (DD-MM-AAAA):</label>
                <input type="text" id="birth-date" placeholder="DD-MM-AAAA" required>
            </div>
            
            <div class="form-group">
                <label for="phone">Telefone:</label>
                <input type="tel" id="phone" placeholder="(00) 00000-0000" required>
            </div>
            
            <div id="category-section" class="form-group" style="display: none;">
                <label for="category">Categoria:</label>
                <select id="category" required>
                    <option value="">Selecione sua categoria</option>
                    <option value="Sub40">Sub40</option>
                    <option value="Sub50">Sub50</option>
                    <option value="Sub60">Sub60</option>
                    <option value="60+">60+</option>
                    <option value="Iniciantes">Iniciantes</option>
                    <option value="Feminino Open">Feminino Open</option>
                    <option value="MTB Open">MTB Open</option>
                    <option value="PCD">PCD</option>
                </select>
            </div>
            
            <div id="modality-section" class="form-group" style="display: none;">
                <label for="modality">Modalidade:</label>
                <select id="modality" required>
                    <option value="">Selecione sua modalidade</option>
                    <option value="Fast Triathlon">Fast Triathlon</option>
                    <option value="Aquathlon">Aquathlon</option>
                    <option value="Aquathlon">Aquathlon Revezamento</option>
                    <option value="Maratona Aquática 1500">Maratona Aquática 1500</option>
                    <option value="Maratona Aquática 3000">Maratona Aquática 3000</option>
                    <option value="Kids">Kids</option>
                    <option value="Corrida Noturna">Corrida Noturna</option>
                    <option value="Corrida">Corrida</option>
                    <option value="Triathlon Olímpico">Triathlon Olímpico</option>
                    <option value="Short Triathlon">Short Triathlon</option>
                    <option value="5K">5K</option>
                    <option value="10K">10K</option>
                    <option value="21K">21K</option>
                    <option value="42K">42K</option>
                </select>
            </div>
            
            <div class="loading-spinner" id="register-spinner"></div>
            <button id="confirm-register-btn" class="btn btn-success">Confirmar Inscrição</button>
        </div>
    </div>
    
    <!-- Modal de login -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Login Administrativo</h2>
            <div class="form-group">
                <label for="admin-email">Email:</label>
                <input type="email" id="admin-email" required>
            </div>
            <div class="form-group">
                <label for="admin-password">Senha:</label>
                <input type="password" id="admin-password" required>
            </div>
            <button id="confirm-login-btn" class="btn btn-success">Login</button>
            <p id="login-error" style="color: red; display: none;">Email ou senha incorretos.</p>
        </div>
    </div>
    
    <!-- Modal de adição/edição de prova -->
    <div id="race-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="race-modal-title">Adicionar Nova Prova</h2>
            
            <div class="form-group">
                <label for="race-name">Nome da Prova:</label>
                <input type="text" id="race-name" required>
            </div>
            
            <div class="form-group">
                <label for="race-date">Data da Prova:</label>
                <input type="date" id="race-date" required>
            </div>
            
            <div class="form-group">
                <label for="race-price">Valor da Inscrição (R$):</label>
                <input type="number" id="race-price" min="0" step="0.01" required>
            </div>
            
            <div class="form-group">
                <label for="race-description">Descrição (opcional):</label>
                <textarea id="race-description" rows="3" style="width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 4px;"></textarea>
            </div>
            
            <div class="form-group image-upload">
                <label for="race-image-url">URL da Imagem (opcional):</label>
                <input type="text" id="race-image-url" placeholder="Cole a URL da imagem aqui">
            </div>
            
            <div class="form-group">
                <label for="regulation-link">Link do Regulamento (Google Drive):</label>
                <input type="text" id="regulation-link" placeholder="Cole o link compartilhável do Google Drive">
                <small>Certifique-se de que o link está configurado como "Qualquer pessoa com o link pode visualizar"</small>
            </div>
            
            <div class="options-container">
                <div class="options-title">Opções de Inscrição:</div>
                <div>
                    <input type="checkbox" id="use-categories" class="options-checkbox">
                    <label for="use-categories">Usar Categorias</label>
                </div>
                <div id="categories-list" class="options-list" style="display: none;">
                    <div class="option-item">
                        <input type="checkbox" id="cat-sub40" value="Sub40" checked>
                        <label for="cat-sub40">Sub40</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="cat-sub50" value="Sub50" checked>
                        <label for="cat-sub50">Sub50</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="cat-sub60" value="Sub60" checked>
                        <label for="cat-sub60">Sub60</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="cat-60plus" value="60+" checked>
                        <label for="cat-60plus">60+</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="cat-iniciantes" value="Iniciantes" checked>
                        <label for="cat-iniciantes">Iniciantes</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="cat-feminino" value="Feminino Open" checked>
                        <label for="cat-feminino">Feminino Open</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="cat-mtb" value="MTB Open" checked>
                        <label for="cat-mtb">MTB Open</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="cat-pcd" value="PCD" checked>
                        <label for="cat-mtb">PCD</label>
                    </div>
                </div>
                
                <div style="margin-top: 15px;">
                    <input type="checkbox" id="use-modalities" class="options-checkbox">
                    <label for="use-modalities">Usar Modalidades</label>
                </div>
                <div id="modalities-list" class="options-list" style="display: none;">
                    <div class="option-item">
                        <input type="checkbox" id="mod-fast" value="Fast Triathlon" checked>
                        <label for="mod-fast">Fast Triathlon</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="mod-aqua" value="Aquathlon" checked>
                        <label for="mod-aqua">Aquathlon</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="mod-aqua-rev" value="Aquathlon Revezamento" checked>
                        <label for="mod-aqua-rev">Aquathlon Revezamento</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="mod-maratona-1500" value="Maratona Aquática 1500" checked>
                        <label for="mod-maratona-1500">Maratona Aquática 1500</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="mod-maratona-3000" value="Maratona Aquática 3000" checked>
                        <label for="mod-maratona-3000">Maratona Aquática 3000</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="mod-corrida-noturna" value="Corrida Noturna" checked>
                        <label for="mod-corrida-noturna">Corrida Noturna</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="mod-corrida" value="Corrida" checked>
                        <label for="mod-corrida">Corrida</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="mod-tri-olimpico" value="Triathlon Olímpico" checked>
                        <label for="mod-tri-olimpico">Triathlon Olímpico</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="mod-short-tri" value="Short Triathlon" checked>
                        <label for="mod-short-tri">Short Triathlon</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="mod-5k" value="5K" checked>
                        <label for="mod-5k">5K</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="mod-10k" value="10K" checked>
                        <label for="mod-10k">10K</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="mod-21k" value="21K" checked>
                        <label for="mod-21k">21K</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="mod-42k" value="42K" checked>
                        <label for="mod-42k">42K</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="mod-kids" value="Kids" checked>
                        <label for="mod-kids">Kids</label>
                    </div>
                </div>
            </div>
            
            <div class="loading-spinner" id="race-spinner"></div>
            <button id="save-race-btn" class="btn btn-success">Salvar Prova</button>
            <button id="delete-race-btn" class="btn btn-danger" style="display: none; margin-top: 10px;">Excluir Prova</button>
        </div>
    </div>
    
    <!-- Modal de edição de inscrito -->
    <div id="rider-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Editar Inscrito</h2>
            <p id="rider-race-name" style="font-weight: bold; margin-bottom: 20px;"></p>
            
            <div class="form-group">
                <label for="edit-name">Nome Completo:</label>
                <input type="text" id="edit-name" required>
            </div>
            
            <div id="edit-category-section" class="form-group" style="display: none;">
                <label for="edit-category">Categoria:</label>
                <select id="edit-category">
                    <option value="Sub40">Sub40</option>
                    <option value="Sub50">Sub50</option>
                    <option value="Sub60">Sub60</option>
                    <option value="60+">60+</option>
                    <option value="Iniciantes">Iniciantes</option>
                    <option value="Feminino Open">Feminino Open</option>
                    <option value="MTB Open">MTB Open</option>
                    <option value="PCD">PCD</option>
                </select>
            </div>
            
            <div id="edit-modality-section" class="form-group" style="display: none;">
                <label for="edit-modality">Modalidade:</label>
                <select id="edit-modality">
                    <option value="Fast Triathlon">Fast Triathlon</option>
                    <option value="Aquathlon">Aquathlon</option>
                    <option value="Aquathlon Revezamento">Aquathlon Revezamento</option>
                    <option value="Maratona Aquática 1500">Maratona Aquática 1500</option>
                    <option value="Maratona Aquática 3000">Maratona Aquática 3000</option>
                    <option value="Kids">Kids</option>
                    <option value="Corrida Noturna">Corrida Noturna</option>
                    <option value="Corrida">Corrida</option>
                    <option value="Triathlon Olímpico">Triathlon Olímpico</option>
                    <option value="Short Triathlon">Short Triathlon</option>
                    <option value="5K">5K</option>
                    <option value="10K">10K</option>
                    <option value="21K">21K</option>
                    <option value="42K">42K</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="edit-status">Status:</label>
                <select id="edit-status" required>
                    <option value="pending">Contato Pendente</option>
                    <option value="waiting">Aguardando Pagamento</option>
                    <option value="completed">Pagamento Concluído</option>
                </select>
            </div>
            
            <div class="loading-spinner" id="rider-spinner"></div>
            <button id="save-rider-btn" class="btn btn-success">Salvar Alterações</button>
            <button id="delete-rider-btn" class="btn btn-danger" style="margin-top: 10px;">Excluir Inscrição</button>
        </div>
    </div>
    
    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAwkcOWdZf46_TZQlHE2N_k0C0wVbmqKks",
            authDomain: "rankingubatubadeciclismo.firebaseapp.com",
            projectId: "rankingubatubadeciclismo",
            storageBucket: "rankingubatubadeciclismo.firebasestorage.app",
            messagingSenderId: "164808638910",
            appId: "1:164808638910:web:0278c92e92872f038939ef"
        };
        
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();
        
        // Variáveis globais
        let isAdmin = false;
        let currentRaceId = null;
        let currentRiderId = null;
        let editingRaceId = null;
        
        // Elementos do DOM
        const racesContainer = document.getElementById('races-container');
        const loginBtn = document.getElementById('login-btn');
        const adminPanel = document.getElementById('admin-panel');
        const logoutBtn = document.getElementById('logout-btn');
        const addRaceBtn = document.getElementById('add-race-btn');
        const registerModal = document.getElementById('register-modal');
        const loginModal = document.getElementById('login-modal');
        const raceModal = document.getElementById('race-modal');
        const riderModal = document.getElementById('rider-modal');
        const closeButtons = document.getElementsByClassName('close');
        const confirmRegisterBtn = document.getElementById('confirm-register-btn');
        const fullNameInput = document.getElementById('full-name');
        const birthDateInput = document.getElementById('birth-date');
        const phoneInput = document.getElementById('phone');
        const categoryInput = document.getElementById('category');
        const modalityInput = document.getElementById('modality');
        const categorySection = document.getElementById('category-section');
        const modalitySection = document.getElementById('modality-section');
        const confirmLoginBtn = document.getElementById('confirm-login-btn');
        const adminEmailInput = document.getElementById('admin-email');
        const adminPasswordInput = document.getElementById('admin-password');
        const loginError = document.getElementById('login-error');
        const raceNameInput = document.getElementById('race-name');
        const raceDateInput = document.getElementById('race-date');
        const racePriceInput = document.getElementById('race-price');
        const raceDescriptionInput = document.getElementById('race-description');
        const raceImageUrlInput = document.getElementById('race-image-url');
        const regulationLinkInput = document.getElementById('regulation-link');
        const saveRaceBtn = document.getElementById('save-race-btn');
        const deleteRaceBtn = document.getElementById('delete-race-btn');
        const raceModalTitle = document.getElementById('race-modal-title');
        const raceSelectedName = document.getElementById('race-selected-name');
        const riderRaceName = document.getElementById('rider-race-name');
        const editNameInput = document.getElementById('edit-name');
        const editCategoryInput = document.getElementById('edit-category');
        const editModalityInput = document.getElementById('edit-modality');
        const editCategorySection = document.getElementById('edit-category-section');
        const editModalitySection = document.getElementById('edit-modality-section');
        const editStatusInput = document.getElementById('edit-status');
        const saveRiderBtn = document.getElementById('save-rider-btn');
        const deleteRiderBtn = document.getElementById('delete-rider-btn');
        const registerSpinner = document.getElementById('register-spinner');
        const raceSpinner = document.getElementById('race-spinner');
        const riderSpinner = document.getElementById('rider-spinner');
        const racesSpinner = document.getElementById('races-spinner');
        const useCategoriesCheckbox = document.getElementById('use-categories');
        const categoriesList = document.getElementById('categories-list');
        const useModalitiesCheckbox = document.getElementById('use-modalities');
        const modalitiesList = document.getElementById('modalities-list');
        
        // Inicializar a aplicação
        function initApp() {
            // Configurar máscaras
            $('#phone').mask('(00) 00000-0000');
            $('#birth-date').mask('00-00-0000');
            
            // Verificar estado de autenticação
            auth.onAuthStateChanged(user => {
                if (user && user.email === "ruc@ruc.com") {
                    isAdmin = true;
                    adminPanel.style.display = 'block';
                    loginBtn.textContent = 'Admin Logado';
                    loginBtn.disabled = true;
                } else {
                    isAdmin = false;
                    adminPanel.style.display = 'none';
                    loginBtn.textContent = 'Login Admin';
                    loginBtn.disabled = false;
                }
            });
            
            // Carregar provas
            loadRaces();
            
            // Event listeners
            loginBtn.addEventListener('click', openLoginModal);
            confirmLoginBtn.addEventListener('click', loginAdmin);
            logoutBtn.addEventListener('click', logoutAdmin);
            addRaceBtn.addEventListener('click', () => openRaceModal());
            saveRaceBtn.addEventListener('click', saveRace);
            deleteRaceBtn.addEventListener('click', () => deleteRace());
            confirmRegisterBtn.addEventListener('click', confirmRegistration);
            saveRiderBtn.addEventListener('click', saveRider);
            deleteRiderBtn.addEventListener('click', () => deleteRider());
            
            // Event listeners para checkboxes de opções
            useCategoriesCheckbox.addEventListener('change', function() {
                categoriesList.style.display = this.checked ? 'flex' : 'none';
            });
            
            useModalitiesCheckbox.addEventListener('change', function() {
                modalitiesList.style.display = this.checked ? 'flex' : 'none';
            });
            
            // Fechar modais ao clicar no X
            for (let i = 0; i < closeButtons.length; i++) {
                closeButtons[i].addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            }
            
            // Fechar modais ao clicar fora
            window.addEventListener('click', function(event) {
                if (event.target.className === 'modal') {
                    event.target.style.display = 'none';
                }
            });
        }
        
        // Carregar provas do Firebase
        function loadRaces() {
            racesSpinner.style.display = 'block';
            racesContainer.innerHTML = '';
            
            database.ref('cyclingRaces').on('value', snapshot => {
                racesSpinner.style.display = 'none';
                
                if (!snapshot.exists()) {
                    racesContainer.innerHTML = '<p>Nenhuma prova disponível no momento.</p>';
                    return;
                }
                
                const races = snapshot.val();
                let hasOpenRaces = false;
                
                racesContainer.innerHTML = '';
                
                for (const raceId in races) {
                    const race = races[raceId];
                    const raceElement = createRaceElement(raceId, race);
                    racesContainer.appendChild(raceElement);
                    
                    if (race.status === 'open') {
                        hasOpenRaces = true;
                    }
                }
                
                if (!hasOpenRaces) {
                    racesContainer.innerHTML += '<p style="text-align: center;">Não há provas com inscrições abertas no momento.</p>';
                }
            }, error => {
                console.error("Erro ao carregar provas:", error);
                racesSpinner.style.display = 'none';
                racesContainer.innerHTML = '<p>Ocorreu um erro ao carregar as provas. Por favor, recarregue a página.</p>';
            });
        }
        
        // Criar elemento HTML para uma prova
        function createRaceElement(raceId, race) {
            const raceElement = document.createElement('div');
            raceElement.className = 'race-card';
            
            const statusClass = race.status === 'open' ? 'status-open' : 'status-closed';
            const statusText = race.status === 'open' ? 'Inscrições Abertas' : 'Inscrições Encerradas';
            
            raceElement.innerHTML = `
                <h3 class="race-title">${race.name}</h3>
                <div class="race-info">
                    <span class="race-date">Data: ${formatDate(race.date)}</span>
                    <span class="race-price">Valor: R$${race.price.toFixed(2)}</span>
                    <span class="race-status ${statusClass}">${statusText}</span>
                </div>
                ${race.description ? `<p>${race.description}</p>` : ''}
            `;
            
            // Adicionar imagem da prova se existir
            if (race.imageUrl) {
                raceElement.innerHTML = `
                    <img src="${race.imageUrl}" alt="${race.name}" class="race-image">
                ` + raceElement.innerHTML;
            }
            
            // Adicionar botão de regulamento se existir
            if (race.regulationLink) {
                const fileId = extractFileIdFromGoogleDriveLink(race.regulationLink);
                const downloadLink = `https://drive.google.com/uc?export=download&id=${fileId}`;
                
                raceElement.innerHTML += `
                    <a href="${downloadLink}" class="btn btn-primary regulation-btn" download>
                        Baixar Regulamento
                    </a>
                `;
            }
            
            if (race.status === 'open') {
                const registerBtn = document.createElement('button');
                registerBtn.className = 'btn btn-primary';
                registerBtn.textContent = 'Fazer Inscrição';
                registerBtn.addEventListener('click', () => openRegisterModal(raceId, race));
                raceElement.appendChild(registerBtn);
            }
            
            // Start List (Lista de Inscritos)
            const startListDiv = document.createElement('div');
            startListDiv.className = 'start-list';
            startListDiv.innerHTML = `<h3>Start List</h3>`;
            
            // Filtro de status (apenas para admin)
            if (isAdmin) {
                const filterSelect = document.createElement('select');
                filterSelect.className = 'status-filter';
                filterSelect.innerHTML = `
                    <option value="all">Todos os Status</option>
                    <option value="pending">Contato Pendente</option>
                    <option value="waiting">Aguardando Pagamento</option>
                    <option value="completed">Pagamento Concluído</option>
                `;
                filterSelect.addEventListener('change', (e) => filterStartList(raceId, e.target.value));
                startListDiv.appendChild(filterSelect);
            }
            
            const startListTable = document.createElement('table');
            startListTable.innerHTML = `
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Nome</th>
                        ${race.useCategories ? '<th>Categoria</th>' : ''}
                        ${race.useModalities ? '<th>Modalidade</th>' : ''}
                        ${isAdmin ? '<th>Status</th><th>Ações</th>' : ''}
                    </tr>
                </thead>
                <tbody id="start-list-${raceId}"></tbody>
            `;
            
            // Carregar inscritos para esta prova
            loadRidersForRace(raceId, startListDiv);
            
            startListDiv.appendChild(startListTable);
            raceElement.appendChild(startListDiv);
            
            if (isAdmin) {
                const adminActions = document.createElement('div');
                adminActions.style.marginTop = '15px';
                
                const toggleStatusBtn = document.createElement('button');
                toggleStatusBtn.className = 'btn ' + (race.status === 'open' ? 'btn-danger' : 'btn-success');
                toggleStatusBtn.textContent = race.status === 'open' ? 'Encerrar Inscrições' : 'Abrir Inscrições';
                toggleStatusBtn.style.marginRight = '10px';
                toggleStatusBtn.addEventListener('click', () => toggleRaceStatus(raceId, race.status));
                
                const editRaceBtn = document.createElement('button');
                editRaceBtn.className = 'btn btn-primary';
                editRaceBtn.textContent = 'Editar Prova';
                editRaceBtn.style.marginRight = '10px';
                editRaceBtn.addEventListener('click', () => openRaceModal(raceId, race));
                
                const deleteRaceBtn = document.createElement('button');
                deleteRaceBtn.className = 'btn btn-danger';
                deleteRaceBtn.textContent = 'Excluir Prova';
                deleteRaceBtn.addEventListener('click', () => {
                    if (confirm('Deseja realmente excluir esta prova e todas as inscrições relacionadas?')) {
                        deleteRace(raceId);
                    }
                });
                
                adminActions.appendChild(toggleStatusBtn);
                adminActions.appendChild(editRaceBtn);
                adminActions.appendChild(deleteRaceBtn);
                raceElement.appendChild(adminActions);
            }
            
            return raceElement;
        }
        
        // Extrair ID do arquivo do link do Google Drive
        function extractFileIdFromGoogleDriveLink(url) {
            // Padrão 1: https://drive.google.com/file/d/FILE_ID/view?usp=sharing
            const match1 = url.match(/\/file\/d\/([^\/]+)/);
            if (match1) return match1[1];
            
            // Padrão 2: https://drive.google.com/open?id=FILE_ID
            const match2 = url.match(/[&?]id=([^&]+)/);
            if (match2) return match2[1];
            
            // Padrão 3: FILE_ID diretamente
            if (!url.includes('http')) return url;
            
            return null;
        }
        
        // Carregar inscritos para uma prova específica
        function loadRidersForRace(raceId, container) {
            database.ref('cyclingRegistrations').orderByChild('raceId').equalTo(raceId).on('value', snapshot => {
                const tbody = container.querySelector(`#start-list-${raceId}`);
                tbody.innerHTML = '';
                
                if (snapshot.exists()) {
                    let riders = [];
                    let counter = 1;
                    
                    // Coletar todos os riders e converter para array
                    snapshot.forEach(childSnapshot => {
                        const rider = childSnapshot.val();
                        rider.id = childSnapshot.key;
                        riders.push(rider);
                    });
                    
                    // Ordenar por status: pending -> waiting -> completed
                    riders.sort((a, b) => {
                        const statusOrder = { 'pending': 1, 'waiting': 2, 'completed': 3 };
                        return statusOrder[a.status] - statusOrder[b.status];
                    });
                    
                    // Adicionar riders à tabela
                    riders.forEach(rider => {
                        const statusClass = getStatusClass(rider.status);
                        const statusText = getStatusText(rider.status);
                        
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${String(counter).padStart(3, '0')}</td>
                            <td>${rider.name}</td>
                            ${rider.category ? `<td>${rider.category}</td>` : ''}
                            ${rider.modality ? `<td>${rider.modality}</td>` : ''}
                            ${isAdmin ? `
                            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                            <td>
                                <button class="action-btn edit-btn" data-id="${rider.id}">Editar</button>
                                <button class="action-btn delete-btn" data-id="${rider.id}">Excluir</button>
                            </td>
                            ` : ''}
                        `;
                        tbody.appendChild(tr);
                        counter++;
                    });
                    
                    // Adicionar event listeners para os botões de ação
                    if (isAdmin) {
                        container.querySelectorAll('.edit-btn').forEach(btn => {
                            btn.addEventListener('click', (e) => {
                                e.stopPropagation();
                                openEditRiderModal(btn.dataset.id);
                            });
                        });
                        
                        container.querySelectorAll('.delete-btn').forEach(btn => {
                            btn.addEventListener('click', (e) => {
                                e.stopPropagation();
                                if (confirm('Deseja realmente excluir esta inscrição?')) {
                                    deleteRider(btn.dataset.id);
                                }
                            });
                        });
                    }
                } else {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Nenhum inscrito ainda</td></tr>';
                }
            });
        }
        
        // Filtrar start list por status
        function filterStartList(raceId, status) {
            const tbody = document.querySelector(`#start-list-${raceId}`);
            const rows = tbody.querySelectorAll('tr');
            
            rows.forEach(row => {
                if (status === 'all') {
                    row.style.display = '';
                } else {
                    const statusBadge = row.querySelector('.status-badge');
                    if (statusBadge) {
                        const riderStatus = statusBadge.classList.contains('status-pending') ? 'pending' : 
                                          statusBadge.classList.contains('status-waiting') ? 'waiting' : 'completed';
                        row.style.display = riderStatus === status ? '' : 'none';
                    }
                }
            });
        }
        
        // Obter classe CSS para o status
        function getStatusClass(status) {
            switch(status) {
                case 'pending': return 'status-pending';
                case 'waiting': return 'status-waiting';
                case 'completed': return 'status-completed';
                default: return 'status-pending';
            }
        }
        
        // Obter texto para o status
        function getStatusText(status) {
            switch(status) {
                case 'pending': return 'Contato Pendente';
                case 'waiting': return 'Aguardando Pagamento';
                case 'completed': return 'Pagamento Concluído';
                default: return 'Contato Pendente';
            }
        }
        
        // Formatar data para exibição
        function formatDate(dateString) {
            if (!dateString) return "Data inválida";
            
            // Ajusta para o fuso horário de Brasília (GMT-3)
            const date = new Date(dateString);
            date.setMinutes(date.getMinutes() + date.getTimezoneOffset() + (3 * 60)); // +3 horas
            
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            return date.toLocaleDateString('pt-BR', options);
        }
        
        // Abrir modal de inscrição
        function openRegisterModal(raceId, race) {
            currentRaceId = raceId;
            raceSelectedName.textContent = race.name;
            fullNameInput.value = '';
            birthDateInput.value = '';
            phoneInput.value = '';
            categoryInput.value = '';
            modalityInput.value = '';
            
            // Mostrar apenas as seções relevantes baseado nas opções da prova
            categorySection.style.display = race.useCategories ? 'block' : 'none';
            modalitySection.style.display = race.useModalities ? 'block' : 'none';
            
            registerModal.style.display = 'block';
        }
        
        // Confirmar inscrição
        async function confirmRegistration() {
            const name = fullNameInput.value.trim();
            const birthDate = birthDateInput.value;
            const phone = phoneInput.value.trim();
            const category = categoryInput.value;
            const modality = modalityInput.value;
            
            // Validação dos campos
            if (!name) {
                alert('Por favor, informe seu nome completo.');
                return;
            }
            
            if (!birthDate || !/^\d{2}-\d{2}-\d{4}$/.test(birthDate)) {
                alert('Por favor, informe uma data de nascimento válida no formato DD-MM-AAAA.');
                return;
            }
            
            const phoneDigits = phone.replace(/\D/g, '');
            if (phoneDigits.length < 10) {
                alert('Por favor, insira um telefone válido com DDD.');
                return;
            }
            
            // Verificar se pelo menos uma opção foi selecionada
            const raceSnapshot = await database.ref(`cyclingRaces/${currentRaceId}`).once('value');
            const race = raceSnapshot.val();
            
            if (race.useCategories && !category) {
                alert('Por favor, selecione sua categoria.');
                return;
            }
            
            if (race.useModalities && !modality) {
                alert('Por favor, selecione sua modalidade.');
                return;
            }
            
            registerSpinner.style.display = 'block';
            confirmRegisterBtn.disabled = true;
            
            try {
                // Criar objeto de inscrição
                const registrationData = {
                    raceId: currentRaceId,
                    raceName: race.name,
                    raceDate: race.date,
                    name,
                    birthDate,
                    phone,
                    status: 'pending', // Status padrão: Contato Pendente
                    registrationDate: new Date().toISOString()
                };
                
                // Adicionar categoria ou modalidade conforme configurado na prova
                if (race.useCategories) {
                    registrationData.category = category;
                }
                
                if (race.useModalities) {
                    registrationData.modality = modality;
                }
                
                // Salvar no Firebase
                const newRef = database.ref('cyclingRegistrations').push();
                await newRef.set(registrationData);
                
                // Formatando a data para exibição
                const formattedDate = formatDate(race.date);
                
                // Criar mensagem para WhatsApp
                let whatsappMsg = `Olá, gostaria de confirmar a Inscrição no Ranking Ubatuba de Ciclismo!\n\n` +
                                  `*Prova:* ${race.name}\n` +
                                  `*Data:* ${formattedDate}\n` +
                                  `*Nome:* ${name}\n` +
                                  `*Data Nasc.:* ${birthDate}\n` +
                                  `*Telefone:* ${phone}\n`;
                
                if (race.useCategories) {
                    whatsappMsg += `*Categoria:* ${category}\n`;
                }
                
                if (race.useModalities) {
                    whatsappMsg += `*Modalidade:* ${modality}\n`;
                }
                
                whatsappMsg += `*Valor:* R$${race.price.toFixed(2)}`;
                
                // Abrir WhatsApp
                window.open(`https://wa.me/5512997689586?text=${encodeURIComponent(whatsappMsg)}`, '_blank');
                
                // Fechar modal e limpar campos
                registerModal.style.display = 'none';
                alert('Inscrição realizada com sucesso! Por favor, confirme o pagamento via WhatsApp.');
                
            } catch (error) {
                console.error('Erro na inscrição:', error);
                alert('Ocorreu um erro ao processar sua inscrição. Por favor, tente novamente.');
            } finally {
                registerSpinner.style.display = 'none';
                confirmRegisterBtn.disabled = false;
            }
        }
        
        // Abrir modal de login
        function openLoginModal() {
            loginModal.style.display = 'block';
            loginError.style.display = 'none';
            adminEmailInput.value = '';
            adminPasswordInput.value = '';
        }
        
        // Login do administrador
        function loginAdmin() {
            const email = adminEmailInput.value.trim();
            const password = adminPasswordInput.value.trim();
            
            if (!email || !password) {
                loginError.style.display = 'block';
                return;
            }
            
            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    if (userCredential.user.email === "ruc@ruc.com") {
                        loginModal.style.display = 'none';
                        isAdmin = true;
                        adminPanel.style.display = 'block';
                        loginBtn.textContent = 'Admin Logado';
                        loginBtn.disabled = true;
                        loadRaces();
                    } else {
                        throw new Error('Acesso não autorizado');
                    }
                })
                .catch(error => {
                    console.error('Erro no login:', error);
                    loginError.style.display = 'block';
                });
        }
        
        // Logout do administrador
        function logoutAdmin() {
            auth.signOut()
                .then(() => {
                    isAdmin = false;
                    adminPanel.style.display = 'none';
                    loginBtn.textContent = 'Login Admin';
                    loginBtn.disabled = false;
                    loadRaces();
                })
                .catch(error => {
                    console.error('Erro no logout:', error);
                });
        }
        
        // Abrir modal de prova (para adicionar ou editar)
        function openRaceModal(raceId = null, raceData = null) {
            editingRaceId = raceId;
            
            if (raceId && raceData) {
                // Modo edição
                raceModalTitle.textContent = 'Editar Prova';
                raceNameInput.value = raceData.name;
                raceDateInput.value = raceData.date;
                racePriceInput.value = raceData.price;
                raceDescriptionInput.value = raceData.description || '';
                raceImageUrlInput.value = raceData.imageUrl || '';
                regulationLinkInput.value = raceData.regulationLink || '';
                deleteRaceBtn.style.display = 'inline-block';
                
                // Configurar checkboxes de opções
                useCategoriesCheckbox.checked = raceData.useCategories || false;
                categoriesList.style.display = raceData.useCategories ? 'flex' : 'none';
                
                useModalitiesCheckbox.checked = raceData.useModalities || false;
                modalitiesList.style.display = raceData.useModalities ? 'flex' : 'none';
                
                // Marcar as categorias selecionadas
                if (raceData.useCategories) {
                    const selectedCategories = raceData.categories || [
                        'Sub40', 'Sub50', 'Sub60', '60+', 'Iniciantes', 'Feminino Open', 'MTB Open', "PCD"
                    ];
                    
                    document.querySelectorAll('#categories-list input[type="checkbox"]').forEach(checkbox => {
                        checkbox.checked = selectedCategories.includes(checkbox.value);
                    });
                }
                
                // Marcar as modalidades selecionadas
                if (raceData.useModalities) {
                    const selectedModalities = raceData.modalities || [
                        'Fast Triathlon', 'Aquathlon', 'Aquathlon Revezamento', 'Maratona Aquática 1500', 'Maratona Aquática 3000', 'Kids'
                    ];
                    
                    document.querySelectorAll('#modalities-list input[type="checkbox"]').forEach(checkbox => {
                        checkbox.checked = selectedModalities.includes(checkbox.value);
                    });
                }
            } else {
                // Modo adição
                raceModalTitle.textContent = 'Adicionar Nova Prova';
                raceNameInput.value = '';
                raceDateInput.value = '';
                racePriceInput.value = '';
                raceDescriptionInput.value = '';
                raceImageUrlInput.value = '';
                regulationLinkInput.value = '';
                deleteRaceBtn.style.display = 'none';
                
                // Resetar checkboxes de opções
                useCategoriesCheckbox.checked = false;
                categoriesList.style.display = 'none';
                useModalitiesCheckbox.checked = false;
                modalitiesList.style.display = 'none';
                
                // Marcar todas as categorias e modalidades por padrão
                document.querySelectorAll('#categories-list input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = true;
                });
                
                document.querySelectorAll('#modalities-list input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = true;
                });
            }
            
            raceModal.style.display = 'block';
        }
        
        // Salvar prova (nova ou edição)
        async function saveRace() {
            const name = raceNameInput.value.trim();
            const date = raceDateInput.value;
            const price = parseFloat(racePriceInput.value);
            const description = raceDescriptionInput.value.trim();
            const imageUrl = raceImageUrlInput.value.trim();
            const regulationLink = regulationLinkInput.value.trim();
            const useCategories = useCategoriesCheckbox.checked;
            const useModalities = useModalitiesCheckbox.checked;
            
            if (!name || !date || isNaN(price) || price <= 0) {
                alert('Por favor, preencha todos os campos obrigatórios com valores válidos.');
                return;
            }
            
            if (!useCategories && !useModalities) {
                alert('Por favor, selecione pelo menos uma opção (Categorias ou Modalidades).');
                return;
            }
            
            raceSpinner.style.display = 'block';
            saveRaceBtn.disabled = true;
            
            const raceData = {
                name,
                date,
                price,
                description: description || null,
                imageUrl: imageUrl || null,
                regulationLink: regulationLink || null,
                status: 'open',
                useCategories,
                useModalities,
                createdAt: new Date().toISOString()
            };
            
            // Adicionar categorias selecionadas
            if (useCategories) {
                const selectedCategories = [];
                document.querySelectorAll('#categories-list input[type="checkbox"]:checked').forEach(checkbox => {
                    selectedCategories.push(checkbox.value);
                });
                raceData.categories = selectedCategories;
            }
            
            // Adicionar modalidades selecionadas
            if (useModalities) {
                const selectedModalities = [];
                document.querySelectorAll('#modalities-list input[type="checkbox"]:checked').forEach(checkbox => {
                    selectedModalities.push(checkbox.value);
                });
                raceData.modalities = selectedModalities;
            }
            
            try {
                if (editingRaceId) {
                    // Atualizar prova existente
                    await database.ref(`cyclingRaces/${editingRaceId}`).update(raceData);
                    alert('Prova atualizada com sucesso!');
                } else {
                    // Criar nova prova
                    await database.ref('cyclingRaces').push(raceData);
                    alert('Prova cadastrada com sucesso!');
                }
                
                raceModal.style.display = 'none';
            } catch (error) {
                console.error('Erro ao salvar prova:', error);
                alert('Ocorreu um erro ao salvar a prova. Por favor, tente novamente.');
            } finally {
                raceSpinner.style.display = 'none';
                saveRaceBtn.disabled = false;
            }
        }
        
        // Excluir prova
        async function deleteRace(raceId = null) {
            const idToDelete = raceId || editingRaceId;
            
            if (!idToDelete) {
                alert("Nenhuma prova selecionada para exclusão!");
                return;
            }

            if (!confirm('Tem certeza que deseja excluir esta prova e todas as inscrições relacionadas?')) {
                return;
            }

            raceSpinner.style.display = 'block';
            deleteRaceBtn.disabled = true;

            try {
                // 1. Primeiro deleta todas as inscrições relacionadas
                const registrationsRef = database.ref('cyclingRegistrations');
                const query = registrationsRef.orderByChild('raceId').equalTo(idToDelete);
                
                const snapshot = await query.once('value');
                const deletePromises = [];
                
                snapshot.forEach(child => {
                    deletePromises.push(child.ref.remove());
                });

                // 2. Espera todas as exclusões de inscrições terminarem
                await Promise.all(deletePromises);
                
                // 3. Depois deleta a prova
                await database.ref(`cyclingRaces/${idToDelete}`).remove();
                
                alert('Prova e inscrições excluídas com sucesso!');
                raceModal.style.display = 'none';
                loadRaces(); // Recarrega a lista
            } catch (error) {
                console.error('Erro detalhado:', error);
                alert('Erro ao excluir: ' + error.message);
            } finally {
                raceSpinner.style.display = 'none';
                deleteRaceBtn.disabled = false;
            }
        }
        
        // Alternar status da prova (aberto/fechado)
        function toggleRaceStatus(raceId, currentStatus) {
            const newStatus = currentStatus === 'open' ? 'closed' : 'open';
            const confirmMsg = newStatus === 'open' 
                ? 'Deseja realmente abrir as inscrições para esta prova?' 
                : 'Deseja realmente encerrar as inscrições para esta prova?';
            
            if (confirm(confirmMsg)) {
                database.ref(`cyclingRaces/${raceId}/status`).set(newStatus)
                    .then(() => {
                        alert(`Inscrições ${newStatus === 'open' ? 'abertas' : 'encerradas'} com sucesso!`);
                    })
                    .catch(error => {
                        console.error('Erro ao atualizar status:', error);
                        alert('Ocorreu um erro ao atualizar o status da prova.');
                    });
            }
        }
        
        // Abrir modal para editar inscrito
        async function openEditRiderModal(riderId) {
            currentRiderId = riderId;
            
            try {
                const snapshot = await database.ref(`cyclingRegistrations/${riderId}`).once('value');
                const rider = snapshot.val();
                
                // Obter dados da prova para saber quais opções mostrar
                const raceSnapshot = await database.ref(`cyclingRaces/${rider.raceId}`).once('value');
                const race = raceSnapshot.val();
                
                riderRaceName.textContent = rider.raceName;
                editNameInput.value = rider.name;
                editStatusInput.value = rider.status || 'pending';
                
                // Mostrar seções de categoria e modalidade conforme configurado na prova
                editCategorySection.style.display = race.useCategories ? 'block' : 'none';
                editModalitySection.style.display = race.useModalities ? 'block' : 'none';
                
                if (race.useCategories) {
                    editCategoryInput.value = rider.category || 'Sub40';
                }
                
                if (race.useModalities) {
                    editModalityInput.value = rider.modality || 'Fast Triathlon';
                }
                
                riderModal.style.display = 'block';
            } catch (error) {
                console.error('Erro ao carregar dados do inscrito:', error);
                alert('Não foi possível carregar os dados do inscrito.');
            }
        }
        
        // Salvar edição de inscrito
        async function saveRider() {
            const name = editNameInput.value.trim();
            const status = editStatusInput.value;
            
            if (!name || !status) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            riderSpinner.style.display = 'block';
            saveRiderBtn.disabled = true;
            
            try {
                // Obter dados atuais do inscrito para pegar raceId
                const riderSnapshot = await database.ref(`cyclingRegistrations/${currentRiderId}`).once('value');
                const rider = riderSnapshot.val();
                
                // Obter dados da prova para saber quais campos atualizar
                const raceSnapshot = await database.ref(`cyclingRaces/${rider.raceId}`).once('value');
                const race = raceSnapshot.val();
                
                const updateData = {
                    name,
                    status
                };
                
                // Atualizar categoria se a prova usar categorias
                if (race.useCategories) {
                    updateData.category = editCategoryInput.value;
                }
                
                // Atualizar modalidade se a prova usar modalidades
                if (race.useModalities) {
                    updateData.modality = editModalityInput.value;
                }
                
                await database.ref(`cyclingRegistrations/${currentRiderId}`).update(updateData);
                
                riderModal.style.display = 'none';
                alert('Inscrição atualizada com sucesso!');
            } catch (error) {
                console.error('Erro ao atualizar inscrito:', error);
                alert('Ocorreu um erro ao atualizar a inscrição. Por favor, tente novamente.');
            } finally {
                riderSpinner.style.display = 'none';
                saveRiderBtn.disabled = false;
            }
        }
        
        // Excluir inscrito
        async function deleteRider(riderId = null) {
            const idToDelete = riderId || currentRiderId;
            if (!idToDelete) return;
            
            if (!confirm('Tem certeza que deseja excluir esta inscrição?')) {
                return;
            }
            
            riderSpinner.style.display = 'block';
            deleteRiderBtn.disabled = true;
            
            try {
                await database.ref(`cyclingRegistrations/${idToDelete}`).remove();
                
                if (!riderId) {
                    riderModal.style.display = 'none';
                }
                
                alert('Inscrição excluída com sucesso!');
            } catch (error) {
                console.error('Erro ao excluir inscrito:', error);
                alert('Ocorreu um erro ao excluir a inscrição. Por favor, tente novamente.');
            } finally {
                riderSpinner.style.display = 'none';
                deleteRiderBtn.disabled = false;
            }
        }
        
        // Iniciar aplicação
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
